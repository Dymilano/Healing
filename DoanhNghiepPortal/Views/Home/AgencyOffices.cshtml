@model IEnumerable<DoanhNghiepPortal.Models.BusinessRegistrationOffice>
@{
    ViewData["Title"] = "Cơ quan Đăng ký kinh doanh các tỉnh, thành phố";
}

<div class="main-banner wow fadeIn" id="top" data-wow-duration="1s" data-wow-delay="0.5s">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-6 align-self-center">
                        <div class="left-content header-text wow fadeInLeft" data-wow-duration="1s" data-wow-delay="1s">
                            <h6>Tra cứu thông tin</h6>
                            <h2>Cơ quan <em>Đăng ký kinh doanh</em> các <span>Tỉnh, Thành phố</span></h2>
                            <p>Tra cứu thông tin liên hệ của các cơ quan đăng ký kinh doanh tại các tỉnh, thành phố trên toàn quốc. Hỗ trợ tìm kiếm nhanh chóng và chính xác.</p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="right-image wow fadeInRight" data-wow-duration="1s" data-wow-delay="0.5s">
                            <img src="~/assets/images/banner-right-image.png" alt="Business Registration Offices">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container" style="margin-top: 50px; padding-top: 30px;">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
            <li class="breadcrumb-item active" aria-current="page">Cơ quan Đăng ký kinh doanh các tỉnh, thành phố</li>
        </ol>
    </nav>

    <!-- Khối lọc và tìm kiếm thống nhất -->
    <div class="filter-section wow fadeInUp" data-wow-duration="1s" data-wow-delay="0.3s">
        <div class="card shadow-lg border-0" style="border-radius: 20px; overflow: hidden;">
            <div class="card-body" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem;">
                <div class="row g-3">
                    <!-- Dropdown lọc -->
                    <div class="col-lg-4 col-md-6">
                        <div class="form-group">
                            <label class="form-label fw-bold mb-2">
                                <i class="fas fa-map-marker-alt me-2"></i>Tỉnh/Thành phố
                            </label>
                            <select class="form-select form-select-lg" id="citySelect" style="border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <option value="">--- Chọn Tỉnh/Thành phố ---</option>
                                @if (Model != null)
                                {
                                    @foreach (var office in Model)
                                    {
                                        <option value="@office.ProvinceCity">@office.ProvinceCity</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-lg-4 col-md-6">
                        <div class="form-group">
                            <label class="form-label fw-bold mb-2">
                                <i class="fas fa-building me-2"></i>Đơn vị hành chính
                            </label>
                            <select class="form-select form-select-lg" id="unitSelect" style="border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <option value="">--- Chọn đơn vị hành chính ---</option>
                                <option value="so-tai-chinh">Sở Tài chính</option>
                                <option value="trung-tam-hanh-chinh-cong">Trung tâm Hành Chính Công</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-lg-4 col-md-6">
                        <div class="form-group">
                            <label class="form-label fw-bold mb-2">
                                <i class="fas fa-search me-2"></i>Tìm kiếm
                            </label>
                            <div class="input-group">
                                <input type="text" class="form-control form-control-lg" id="searchInput" 
                                       placeholder="Tìm theo tên TP, SĐT, email..." 
                                       style="border-radius: 15px 0 0 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <button class="btn btn-light btn-lg" id="searchBtn" 
                                        style="border-radius: 0 15px 15px 0; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nút lọc -->
                    <div class="col-12 text-center mt-3">
                        <button class="btn btn-light btn-lg px-5" id="filterBtn" 
                                style="border-radius: 25px; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                            <i class="fas fa-filter me-2"></i>LỌC DỮ LIỆU
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bảng kết quả -->
    <div class="row mt-5">
        <div class="col-lg-9">
            <div class="card shadow-lg border-0" style="border-radius: 20px; overflow: hidden;">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold text-primary">
                        <i class="fas fa-table me-2"></i>Danh sách cơ quan đăng ký kinh doanh
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="resultTable">
                            <thead class="table-light">
                                <tr>
                                    <th style="width:8%" class="text-center">STT</th>
                                    <th style="width:25%">Tỉnh/Thành phố</th>
                                    <th style="width:67%">Thông tin liên hệ</th>
                                </tr>
                            </thead>
                            <tbody id="resultBody">
                                @if (Model != null && Model.Any())
                                {
                                    @foreach (var office in Model)
                                    {
                                        <tr data-province="@office.ProvinceCity" 
                                            data-stt="@office.STT"
                                            data-department="@office.DepartmentName"
                                            data-address="@office.Address"
                                            data-phone="@(office.PhoneNumber ?? "")"
                                            data-email="@(office.Email ?? "")"
                                            data-website="@(office.Website ?? "")"
                                            style="transition: all 0.3s ease;">
                                            <td class="text-center fw-bold text-primary">@office.STT</td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                                    <span class="fw-semibold">@office.ProvinceCity</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="row g-2">
                                                    <div class="col-md-6">
                                                        <div class="d-flex align-items-start mb-2">
                                                            <i class="fas fa-building text-primary me-2 mt-1"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Tên phòng</small>
                                                                <span class="fw-semibold">@office.DepartmentName</span>
                                                            </div>
                                                        </div>
                                                        <div class="d-flex align-items-start mb-2">
                                                            <i class="fas fa-map-marker-alt text-success me-2 mt-1"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Địa chỉ</small>
                                                                <span>@office.Address</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="d-flex align-items-start mb-2">
                                                            <i class="fas fa-phone text-info me-2 mt-1"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Số điện thoại</small>
                                                                <span>@(string.IsNullOrEmpty(office.PhoneNumber) ? "Đang cập nhật" : office.PhoneNumber)</span>
                                                            </div>
                                                        </div>
                                                        <div class="d-flex align-items-start mb-2">
                                                            <i class="fas fa-envelope text-warning me-2 mt-1"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Email</small>
                                                                <span>@(string.IsNullOrEmpty(office.Email) ? "Đang cập nhật" : office.Email)</span>
                                                            </div>
                                                        </div>
                                                        <div class="d-flex align-items-start">
                                                            <i class="fas fa-globe text-danger me-2 mt-1"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Website</small>
                                                                <span>@(string.IsNullOrEmpty(office.Website) ? "Đang cập nhật" : office.Website)</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="3" class="text-center py-5">
                                            @if (ViewBag.Error != null)
                                            {
                                                <div class="alert alert-warning border-0" style="border-radius: 15px;">
                                                    <i class="fas fa-exclamation-triangle me-2"></i> @ViewBag.Error
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="text-muted">
                                                    <i class="fas fa-inbox fa-3x mb-3"></i>
                                                    <p class="mb-0">Không có dữ liệu để hiển thị</p>
                                                </div>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-3">
            <div class="card shadow-lg border-0 mb-4" style="border-radius: 20px; overflow: hidden;">
                <div class="card-header bg-primary text-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-headset me-2"></i>Hỗ trợ
                    </h6>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Hộp thư hỗ trợ đăng ký doanh nghiệp, dịch vụ thông tin, báo cáo điện tử, thanh toán điện tử</p>
                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            <small class="text-break">hotro@dangkykinhdoanh.gov.vn</small>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            <small class="text-break">dichvuthongtin@dangkykinhdoanh.gov.vn</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            <small class="text-break">hotrothanhtoan@dangkykinhdoanh.gov.vn</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card shadow-lg border-0" style="border-radius: 20px; overflow: hidden;">
                <div class="card-header bg-success text-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-bolt me-2"></i>Truy cập nhanh
                    </h6>
                </div>
                <div class="card-body p-3">
                    <a href="#" class="btn btn-outline-primary w-100 mb-2" style="border-radius: 15px;">
                        <i class="fas fa-info-circle me-2"></i>DỊCH VỤ THÔNG TIN
                    </a>
                    <a href="#" class="btn btn-outline-success w-100" style="border-radius: 15px;">
                        <i class="fas fa-laptop me-2"></i>ĐĂNG KÝ QUA MẠNG
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .breadcrumb {
        background: none;
        padding: 0;
        margin-bottom: 1rem;
    }
    
    .filter-section {
        margin-bottom: 2rem;
    }
    
    .form-select, .form-control {
        transition: all 0.3s ease;
    }
    
    .form-select:focus, .form-control:focus {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
    
    .btn {
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa;
        transform: scale(1.01);
    }
    
    .card {
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
    }
    
    .text-primary {
        color: #667eea !important;
    }
    
    .bg-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    .bg-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const citySelect = document.getElementById('citySelect');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const filterBtn = document.getElementById('filterBtn');
        const rows = document.querySelectorAll('#resultBody tr');

        // Hàm lọc theo dropdown
        function filterByDropdown() {
            const selectedCity = citySelect.value;
            
            rows.forEach((row, index) => {
                const rowProvince = row.getAttribute('data-province');
                
                // Hiển thị tất cả nếu không chọn thành phố nào
                const shouldShow = !selectedCity || rowProvince === selectedCity;
                
                if (shouldShow) {
                    row.style.display = '';
                    row.style.opacity = '1';
                } else {
                    row.style.display = 'none';
                    row.style.opacity = '0';
                }
            });
        }

        // Hàm tìm kiếm theo tất cả dữ liệu
        function searchByText() {
            const searchText = searchInput.value.toLowerCase().trim();
            
            rows.forEach((row, index) => {
                // Lấy tất cả dữ liệu từ data attributes
                const stt = row.getAttribute('data-stt') || '';
                const province = row.getAttribute('data-province') || '';
                const department = row.getAttribute('data-department') || '';
                const address = row.getAttribute('data-address') || '';
                const phone = row.getAttribute('data-phone') || '';
                const email = row.getAttribute('data-email') || '';
                const website = row.getAttribute('data-website') || '';
                
                // Tạo chuỗi tìm kiếm từ tất cả dữ liệu
                const searchData = `${stt} ${province} ${department} ${address} ${phone} ${email} ${website}`.toLowerCase();
                
                // Hiển thị nếu bất kỳ dữ liệu nào chứa ký tự tìm kiếm
                const shouldShow = !searchText || searchData.includes(searchText);
                
                if (shouldShow) {
                    row.style.display = '';
                    row.style.opacity = '1';
                } else {
                    row.style.display = 'none';
                    row.style.opacity = '0';
                }
            });
        }

        // Event listeners
        filterBtn.addEventListener('click', filterByDropdown);
        citySelect.addEventListener('change', filterByDropdown);
        
        searchBtn.addEventListener('click', searchByText);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchByText();
            }
        });
        
        // Hiển thị tất cả khi load trang
        filterByDropdown();
    });
</script>